<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Riznica - Efekti</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="ad-overlay"><div class="ad-content"><div class="ad-timer-badge">Preostalo: <span id="ad-countdown">5</span>s</div><button id="ad-close" class="ad-close-btn">‚úï</button><div class="ad-spinner"></div><div class="ad-text">POPUST SE UƒåITAVA...</div><p style="color:#aaa; font-size:0.8rem;">(Simulacija AdMob Reward Videa)</p></div></div>
    <div id="reward-modal"><div class="reward-card"><div class="reward-icon">üí∞</div><div class="reward-title">NAGRADA!</div><div class="reward-msg">Uspe≈°no ste odgledali reklamu.<span class="reward-amount">+500 DUKATA</span></div><button class="btn-claim" onclick="closeRewardModal()">HVALA</button></div></div>
    <div id="notification-modal" class="modal-overlay"><div class="modal-card"><div id="notif-icon" class="modal-icon">‚úÖ</div><div id="notif-title" class="modal-title">USPEH</div><div id="notif-msg" class="modal-msg">Poruka ide ovde.</div><button class="modal-btn btn-modal-ok" onclick="closeNotification()">U REDU</button></div></div>
    <div id="confirm-modal" class="modal-overlay"><div class="modal-card"><div class="modal-icon">üõí</div><div class="modal-title">POTVRDA</div><div id="confirm-msg" class="modal-msg">Da li ≈æelite da kupite ovo?</div><div class="modal-btn-group"><button class="modal-btn btn-modal-cancel" onclick="closeConfirmModal()">OTKA≈ΩI</button><button id="btn-confirm-buy" class="modal-btn btn-modal-confirm">KUPI</button></div></div></div>

    <button class="back-btn" onclick="window.location.href='riznica.html'">‚Üê</button>
    <div class="header">
        <div class="balance-group">
            <button class="ad-btn-small" onclick="watchAdForMoney()"><span>üì∫ +500</span></button>
            <div class="balance-display">üí∞ <span id="balance">0</span></div>
        </div>
    </div>
    <div class="nav-tabs">
        <button class="tab-btn" onclick="window.location.href='riznica.html'">TROFEJI üèÜ</button>
        <button class="tab-btn" onclick="window.location.href='kockice.html'">KOCKICE üé≤</button>
        <button class="tab-btn active">EFEKTI ‚ú®</button>
    </div>
    <div id="content-container" class="content-area"></div>

    <script>
        (function() {
            const savedTheme = localStorage.getItem('yamb_theme') || 'dark';
            if (savedTheme === 'light') document.body.classList.add('light-theme');
            else if (savedTheme === 'medium') document.body.classList.add('medium-theme');
            else if (savedTheme === 'winter') document.body.classList.add('winter-theme');
        })();

        const EFFECTS = [
            { id: 'confetti', name: 'Konfete', price: 0, desc: 'Klasiƒçna proslava Yamba.', duration: '3 sekunde', category: 'üéâ STANDARDNE PROSLAVE', cssClass: 'prev-confetti', innerHtml: '' },
            { id: 'gold_rain', name: 'Zlatna Ki≈°a', price: 10000, desc: 'Padaju dukati sa vrha ekrana.', duration: '4 sekunde', category: 'üéâ STANDARDNE PROSLAVE', cssClass: 'prev-gold_rain', innerHtml: '' },
            { id: 'fireflies', name: 'Magiƒçni Svici', price: 5000, desc: 'Ne≈æne svetleƒáe kuglice koje lebde ka nebu.', duration: '4 sekunde', category: 'üéâ STANDARDNE PROSLAVE', cssClass: 'prev-fireflies', innerHtml: '' },
            { id: 'glass', name: 'Staklena Prizma', price: 12000, desc: 'Pretvara ekran u zamuƒáeno staklo.', duration: 'Trajno', category: 'üíé ATMOSFERA & STIL', cssClass: 'prev-glass', innerHtml: '<div class="glass-overlay"></div>' },
            { id: 'shadow', name: 'Fokus Senka', price: 8000, desc: 'Zatamnjuje sve osim aktivne kolone.', duration: 'Trajno', category: 'üíé ATMOSFERA & STIL', cssClass: 'prev-shadow', innerHtml: '<div class="shadow-overlay"></div>' },
            { id: 'neon_pulse', name: 'Neon Puls', price: 15000, desc: 'Cyberpunk linije skeniraju ekran.', duration: '2 sekunde', category: 'üíé ATMOSFERA & STIL', cssClass: 'prev-neon', innerHtml: '<div class="neon-line"></div>' },
            { id: 'thunder', name: 'Gromovnik', price: 20000, desc: 'Ekran se trese uz udar groma.', duration: '1 sekunda', category: '‚ö° SPEKTAKL & ZABAVA', req: 'sveti_ilija', reqName: 'Sveti Ilija', cssClass: 'prev-thunder', innerHtml: '' },
            { id: 'balkan', name: 'Svadba', price: 25000, desc: 'Trubaƒçi, pare i op≈°tenarodno veselje.', duration: '5 sekundi', category: '‚ö° SPEKTAKL & ZABAVA', cssClass: 'prev-balkan', innerHtml: '' },
            { id: 'fireworks', name: 'Grandiozni Vatromet', price: 30000, desc: 'Eksplozija boja za prave pobednike.', duration: '5 sekundi', category: '‚ö° SPEKTAKL & ZABAVA', cssClass: 'prev-fireworks', innerHtml: '' }
        ];

        let unlocked = JSON.parse(localStorage.getItem('yamb_unlocked')) || ['first_play', 'default', 'confetti'];
        let balance = parseInt(localStorage.getItem('yamb_dukati')) || 0;
        let activeEffect = localStorage.getItem('yamb_active_effect') || 'confetti';
        let discountedItems = {}; 
        const balEl = document.getElementById('balance');
        balEl.innerText = balance;
        const container = document.getElementById('content-container');

        function render() {
            container.innerHTML = '';
            const grouped = {};
            EFFECTS.forEach(ef => { if (!grouped[ef.category]) grouped[ef.category] = []; grouped[ef.category].push(ef); });
            for (const [categoryName, items] of Object.entries(grouped)) {
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'category-section';
                const headerDiv = document.createElement('div');
                headerDiv.className = 'category-header';
                headerDiv.innerText = categoryName;
                sectionDiv.appendChild(headerDiv);
                const gridDiv = document.createElement('div');
                gridDiv.className = 'category-grid';
                items.forEach(item => {
                    const isUnlocked = unlocked.includes(item.id);
                    const isActive = activeEffect === item.id;
                    const reqMet = !item.req || unlocked.includes(item.req);
                    const card = document.createElement('div');
                    card.className = `card ${isActive ? 'active-effect' : ''}`;
                    let displayPriceHtml = item.price + ' üí∞';
                    let currentPrice = item.price;
                    let showDiscountBtn = false;
                    if (discountedItems[item.id]) {
                        currentPrice = Math.max(0, item.price - 200);
                        displayPriceHtml = `<span class="old-price">${item.price}</span> ${currentPrice} üí∞`;
                    } else if (!isUnlocked && reqMet && item.price > 0) {
                        showDiscountBtn = true;
                    }
                    let btnHtml = '';
                    if (isActive) {
                        btnHtml = `<button class="btn-action btn-active">AKTIVNO</button>`;
                    } else if (isUnlocked) {
                        btnHtml = `<button class="btn-action btn-equip" onclick="equip('${item.id}')">KORISTI</button>`;
                    } else {
                        if (reqMet) {
                            btnHtml = `<div class="btn-group">
                                <button class="btn-action btn-buy" onclick="openConfirmModal('${item.id}', '${item.name}', ${currentPrice})">KUPI</button>
                                ${showDiscountBtn ? `<button class="btn-action btn-discount" onclick="watchAdForDiscount('${item.id}')">üì∫ % -200</button>` : ''}
                            </div>`;
                        } else {
                            btnHtml = `<div class="req-text">Otkljuƒçaj trofej: ${item.reqName}</div>`;
                        }
                    }
                    card.innerHTML = `<div class="effect-preview-box ${item.cssClass}">${item.innerHtml}</div><div class="title">${item.name}</div><div class="duration">‚è± ${item.duration}</div><div class="desc">${item.desc}</div><div class="price">${isUnlocked ? '‚úî Kupljeno' : displayPriceHtml}</div>${btnHtml}`;
                    gridDiv.appendChild(card);
                });
                sectionDiv.appendChild(gridDiv);
                container.appendChild(sectionDiv);
            }
        }
        function showNotification(title, msg, icon='‚úÖ', type='success') {
            document.getElementById('notif-title').innerText = title;
            document.getElementById('notif-msg').innerText = msg;
            document.getElementById('notif-icon').innerText = icon;
            document.getElementById('notif-title').style.color = type === 'error' ? 'var(--danger)' : 'var(--gold-main)';
            document.getElementById('notification-modal').style.display = 'flex';
        }
        function closeNotification() { document.getElementById('notification-modal').style.display = 'none'; }
        function openConfirmModal(id, name, price) {
            if (balance < price) { showNotification("NEDOVOLJNO NOVCA", "Nemate dovoljno dukata za ovu kupovinu.", "‚ùå", "error"); return; }
            document.getElementById('confirm-msg').innerHTML = `Da li ≈æelite da kupite <b>${name}</b> za <b style="color:var(--gold-main)">${price}</b> dukata?`;
            const btnConfirm = document.getElementById('btn-confirm-buy');
            const newBtn = btnConfirm.cloneNode(true);
            btnConfirm.parentNode.replaceChild(newBtn, btnConfirm);
            newBtn.onclick = () => { closeConfirmModal(); performBuy(id, price, name); };
            document.getElementById('confirm-modal').style.display = 'flex';
        }
        function closeConfirmModal() { document.getElementById('confirm-modal').style.display = 'none'; }
        function performBuy(id, price, name) {
            balance -= price;
            unlocked.push(id);
            localStorage.setItem('yamb_dukati', balance);
            localStorage.setItem('yamb_unlocked', JSON.stringify(unlocked));
            balEl.innerText = balance;
            render();
            showNotification("USPE≈†NA KUPOVINA", `Kupili ste ${name}!`, "üéâ");
        }
        function watchAdForDiscount(itemId) {
            document.querySelector('.ad-text').innerText = "POPUST SE UƒåITAVA...";
            simulateAd(() => { discountedItems[itemId] = true; render(); });
        }
        function watchAdForMoney() {
            document.querySelector('.ad-text').innerText = "NAGRADA SE UƒåITAVA...";
            simulateAd(() => { balance += 500; localStorage.setItem('yamb_dukati', balance); balEl.innerText = balance; showRewardModal(); });
        }
        function showRewardModal() { document.getElementById('reward-modal').style.display = 'flex'; }
        function closeRewardModal() { document.getElementById('reward-modal').style.display = 'none'; }
        function simulateAd(callback) {
            const overlay = document.getElementById('ad-overlay');
            const counter = document.getElementById('ad-countdown');
            const closeBtn = document.getElementById('ad-close');
            let timeLeft = 5; 
            counter.innerText = timeLeft;
            overlay.style.display = 'flex';
            closeBtn.style.display = 'none';
            const interval = setInterval(() => {
                timeLeft--;
                counter.innerText = timeLeft;
                if (timeLeft <= 0) { clearInterval(interval); closeBtn.style.display = 'flex'; }
            }, 1000);
            closeBtn.onclick = () => { overlay.style.display = 'none'; if(callback) callback(); };
        }
        window.equip = function(id) { activeEffect = id; localStorage.setItem('yamb_active_effect', id); render(); };
        render();
    </script>
</body>
</html>
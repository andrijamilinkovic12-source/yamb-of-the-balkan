<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Riznica - Kockice</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="ad-overlay"><div class="ad-content"><div class="ad-timer-badge">Preostalo: <span id="ad-countdown">5</span>s</div><button id="ad-close" class="ad-close-btn">‚úï</button><div class="ad-spinner"></div><div class="ad-text">POPUST SE UƒåITAVA...</div><p style="color:#aaa; font-size:0.8rem;">(Simulacija AdMob Reward Videa)</p></div></div>
    <div id="reward-modal"><div class="reward-card"><div class="reward-icon">üí∞</div><div class="reward-title">NAGRADA!</div><div class="reward-msg">Uspe≈°no ste odgledali reklamu.<span class="reward-amount">+500 DUKATA</span></div><button class="btn-claim" onclick="closeRewardModal()">HVALA</button></div></div>
    <div id="notification-modal" class="modal-overlay"><div class="modal-card"><div id="notif-icon" class="modal-icon">‚úÖ</div><div id="notif-title" class="modal-title">USPEH</div><div id="notif-msg" class="modal-msg">Poruka ide ovde.</div><button class="modal-btn btn-modal-ok" onclick="closeNotification()">U REDU</button></div></div>
    <div id="confirm-modal" class="modal-overlay"><div class="modal-card"><div class="modal-icon">üõí</div><div class="modal-title">POTVRDA</div><div id="confirm-msg" class="modal-msg">Da li ≈æelite da kupite ovo?</div><div class="modal-btn-group"><button class="modal-btn btn-modal-cancel" onclick="closeConfirmModal()">OTKA≈ΩI</button><button id="btn-confirm-buy" class="modal-btn btn-modal-confirm">KUPI</button></div></div></div>

    <button class="back-btn" onclick="window.location.href='riznica.html'">‚Üê</button>
    <div class="header">
        <div class="balance-group">
            <button class="ad-btn-small" onclick="watchAdForMoney()"><span>üì∫ +500</span></button>
            <div class="balance-display">üí∞ <span id="balance">0</span></div>
        </div>
    </div>
    <div class="nav-tabs">
        <button class="tab-btn" onclick="window.location.href='riznica.html'">TROFEJI üèÜ</button>
        <button class="tab-btn active">KOCKICE üé≤</button>
        <button class="tab-btn" onclick="window.location.href='efekti.html'">EFEKTI ‚ú®</button>
    </div>
    <div id="content-container" class="content-area"></div>

    <script>
        (function() {
            const savedTheme = localStorage.getItem('yamb_theme') || 'dark';
            if (savedTheme === 'light') document.body.classList.add('light-theme');
            else if (savedTheme === 'medium') document.body.classList.add('medium-theme');
            else if (savedTheme === 'winter') document.body.classList.add('winter-theme');
        })();

        const SKINS = [
            { id: 'default', name: 'Standard Bela', price: 0, category: 'üé© KLASIKA & ELEGANCIJA' },
            { id: 'classic_red', name: 'Kazino Crvena', price: 1500, category: 'üé© KLASIKA & ELEGANCIJA' },
            { id: 'classic_blue', name: 'Deep Blue', price: 1500, category: 'üé© KLASIKA & ELEGANCIJA' },
            { id: 'classic_black', name: 'Crna Noƒá', price: 2000, category: 'üé© KLASIKA & ELEGANCIJA' },
            { id: 'wood', name: 'Hrast', price: 3000, category: 'ü™µ MATERIJALI & TEKSTURE' },
            { id: 'marble', name: 'Carrara Mermer', price: 3500, category: 'ü™µ MATERIJALI & TEKSTURE' },
            { id: 'carbon', name: 'Karbon', price: 4000, category: 'ü™µ MATERIJALI & TEKSTURE' },
            { id: 'gold', name: 'Carsko Zlato', price: 5000, category: 'ü™µ MATERIJALI & TEKSTURE' },
            { id: 'neon_blue', name: 'Cyber Blue', price: 6000, category: 'üëæ NEON & FUTURIZAM' },
            { id: 'neon_pink', name: 'Synthwave', price: 6000, category: 'üëæ NEON & FUTURIZAM' },
            { id: 'neon_green', name: 'Matrix', price: 6000, category: 'üëæ NEON & FUTURIZAM' },
            { id: 'stealth', name: 'Stealth Mode', price: 8000, category: 'üëæ NEON & FUTURIZAM' },
            { id: 'glass_clear', name: 'ƒåisti Kristal', price: 10000, category: 'üíé STAKLO & DRAGULJI' },
            { id: 'glass_ruby', name: 'Krvavi Rubin', price: 12000, category: 'üíé STAKLO & DRAGULJI' },
            { id: 'glass_emerald', name: 'Smaragd', price: 12000, category: 'üíé STAKLO & DRAGULJI' },
            { id: 'glass_sapphire', name: 'Safir', price: 12000, category: 'üíé STAKLO & DRAGULJI' },
            { id: 'magma', name: 'Magma Core', price: 15000, category: 'üåå KOSMOS & MISTIKA' },
            { id: 'galaxy', name: 'Galaksija', price: 18000, category: 'üåå KOSMOS & MISTIKA' },
            { id: 'retro', name: 'Retro 8-Bit', price: 20000, category: 'üåå KOSMOS & MISTIKA' },
            { id: 'hologram', name: 'Hologram', price: 25000, category: 'üåå KOSMOS & MISTIKA' }
        ];

        let unlocked = JSON.parse(localStorage.getItem('yamb_unlocked')) || ['first_play', 'default', 'confetti'];
        let balance = parseInt(localStorage.getItem('yamb_dukati')) || 0;
        let activeSkin = localStorage.getItem('yamb_active_skin') || 'default';
        let discountedItems = {}; 

        const balEl = document.getElementById('balance');
        balEl.innerText = balance;
        const container = document.getElementById('content-container');

        function render() {
            container.innerHTML = '';
            const grouped = {};
            SKINS.forEach(skin => {
                if (!grouped[skin.category]) grouped[skin.category] = [];
                grouped[skin.category].push(skin);
            });
            for (const [categoryName, items] of Object.entries(grouped)) {
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'category-section';
                const headerDiv = document.createElement('div');
                headerDiv.className = 'category-header';
                headerDiv.innerText = categoryName;
                sectionDiv.appendChild(headerDiv);
                const gridDiv = document.createElement('div');
                gridDiv.className = 'category-grid';
                items.forEach(item => {
                    const isUnlocked = unlocked.includes(item.id);
                    const isActive = activeSkin === item.id;
                    const card = document.createElement('div');
                    card.className = `card ${isActive ? 'active-skin' : ''}`;
                    let displayPriceHtml = item.price + ' üí∞';
                    let currentPrice = item.price;
                    let showDiscountBtn = false;
                    if (discountedItems[item.id]) {
                        currentPrice = Math.max(0, item.price - 200);
                        displayPriceHtml = `<span class="old-price">${item.price}</span> ${currentPrice} üí∞`;
                    } else if (!isUnlocked && item.price > 0) {
                        showDiscountBtn = true;
                    }
                    let btnHtml = '';
                    if (isActive) {
                        btnHtml = `<button class="btn-action btn-active">AKTIVNO</button>`;
                    } else if (isUnlocked) {
                        btnHtml = `<button class="btn-action btn-equip" onclick="equip('${item.id}')">KORISTI</button>`;
                    } else {
                        btnHtml = `<div class="btn-group">
                            <button class="btn-action btn-buy" onclick="openConfirmModal('${item.id}', '${item.name}', ${currentPrice})">KUPI</button>
                            ${showDiscountBtn ? `<button class="btn-action btn-discount" onclick="watchAdForDiscount('${item.id}')">üì∫ % -200</button>` : ''}
                        </div>`;
                    }
                    card.innerHTML = `<div class="dice-preview preview-${item.id}">‚öÖ</div><div class="title">${item.name}</div><div class="price">${isUnlocked ? '‚úî Kupljeno' : displayPriceHtml}</div>${btnHtml}`;
                    gridDiv.appendChild(card);
                });
                sectionDiv.appendChild(gridDiv);
                container.appendChild(sectionDiv);
            }
        }
        function showNotification(title, msg, icon='‚úÖ', type='success') {
            document.getElementById('notif-title').innerText = title;
            document.getElementById('notif-msg').innerText = msg;
            document.getElementById('notif-icon').innerText = icon;
            document.getElementById('notif-title').style.color = type === 'error' ? 'var(--danger)' : 'var(--gold-main)';
            document.getElementById('notification-modal').style.display = 'flex';
        }
        function closeNotification() { document.getElementById('notification-modal').style.display = 'none'; }
        function openConfirmModal(id, name, price) {
            if (balance < price) { showNotification("NEDOVOLJNO NOVCA", "Nemate dovoljno dukata za ovu kupovinu.", "‚ùå", "error"); return; }
            document.getElementById('confirm-msg').innerHTML = `Da li ≈æelite da kupite <b>${name}</b> za <b style="color:var(--gold-main)">${price}</b> dukata?`;
            const btnConfirm = document.getElementById('btn-confirm-buy');
            const newBtn = btnConfirm.cloneNode(true);
            btnConfirm.parentNode.replaceChild(newBtn, btnConfirm);
            newBtn.onclick = () => { closeConfirmModal(); performBuy(id, price, name); };
            document.getElementById('confirm-modal').style.display = 'flex';
        }
        function closeConfirmModal() { document.getElementById('confirm-modal').style.display = 'none'; }
        function performBuy(id, price, name) {
            balance -= price;
            unlocked.push(id);
            localStorage.setItem('yamb_dukati', balance);
            localStorage.setItem('yamb_unlocked', JSON.stringify(unlocked));
            balEl.innerText = balance;
            render();
            showNotification("USPE≈†NA KUPOVINA", `Kupili ste ${name}!`, "üéâ");
        }
        function watchAdForDiscount(itemId) {
            document.querySelector('.ad-text').innerText = "POPUST SE UƒåITAVA...";
            simulateAd(() => { discountedItems[itemId] = true; render(); });
        }
        function watchAdForMoney() {
            document.querySelector('.ad-text').innerText = "NAGRADA SE UƒåITAVA...";
            simulateAd(() => { balance += 500; localStorage.setItem('yamb_dukati', balance); balEl.innerText = balance; showRewardModal(); });
        }
        function showRewardModal() { document.getElementById('reward-modal').style.display = 'flex'; }
        function closeRewardModal() { document.getElementById('reward-modal').style.display = 'none'; }
        function simulateAd(callback) {
            const overlay = document.getElementById('ad-overlay');
            const counter = document.getElementById('ad-countdown');
            const closeBtn = document.getElementById('ad-close');
            let timeLeft = 5; 
            counter.innerText = timeLeft;
            overlay.style.display = 'flex';
            closeBtn.style.display = 'none';
            const interval = setInterval(() => {
                timeLeft--;
                counter.innerText = timeLeft;
                if (timeLeft <= 0) { clearInterval(interval); closeBtn.style.display = 'flex'; }
            }, 1000);
            closeBtn.onclick = () => { overlay.style.display = 'none'; if(callback) callback(); };
        }
        window.equip = function(id) { activeSkin = id; localStorage.setItem('yamb_active_skin', id); render(); };
        render();
    </script>
</body>
</html>